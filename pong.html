<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>|-- Sherk Pong - Best of 3 (Tennis Style) --|</title>

  <style>
    /* ==================== BASIC STYLES ==================== */
    body {
      margin: 0;
      padding: 0;
      background: url("back.gif") center center no-repeat;
      background-size: cover;
      overflow: hidden;
      font-family: monospace;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    body::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      opacity: 0.5;
      z-index: -1;
    }

    .glow-text {
      font-size: 4vw;
      color: #00ff00;
      text-shadow: 0 0 20px #00ff00, 0 0 40px #0077ff;
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
    }

    /* ====== MATCH (BEST OF 3) LABELS ====== */
    .match-label {
      position: absolute;
      font-size: 3vw;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00;
    }
    #sherkMatches {
      top: 10px;
      left: 20px;
    }
    #bonkMatches {
      top: 10px;
      right: 20px;
    }

    /* ====== GAME SCORE (POINTS) ====== */
    .score-label {
      position: absolute;
      font-size: 5vw;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00;
      font-weight: bold;
    }
    #sherkScore {
      top: 60px;
      left: 60px;
    }
    #bonkScore {
      top: 60px;
      right: 60px;
    }

    /* ====== PLAYER NAMES ====== */
    .player-label {
      position: absolute;
      font-size: 2vw;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00;
    }
    .player-left {
      top: 45px;
      left: 20px;
    }
    .player-right {
      top: 45px;
      right: 20px;
    }

    /* ====== PLAYER IMAGES ====== */
    .player {
      position: absolute;
      height: 200px;
      width: auto;
      animation: glow-animation 1.5s infinite alternate;
    }
    #sherk {
      top: 150px;
      left: 20px;
    }
    #bonk {
      top: 150px;
      right: 20px;
    }

    @keyframes glow-animation {
      0% {
        filter: drop-shadow(0 0 10px #00f0ff);
      }
      50% {
        filter: drop-shadow(0 0 20px #ff0000);
      }
      100% {
        filter: drop-shadow(0 0 10px #00f0ff);
      }
    }

    /* ====== INSTRUCTIONS ====== */
    .instructions-container {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #fff;
    }
    .instructions {
      font-size: 2vw;
      margin-bottom: 20px;
    }
    .button {
      padding: 15px 30px;
      font-size: 2vw;
      color: #fff;
      background: linear-gradient(90deg, #00f0ff, #ff0000);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 0 20px #00f0ff;
    }
    .button:hover {
      box-shadow: 0 0 40px #ff0000;
    }

    /* ====== WINNER MESSAGE ====== */
    #winner-message {
      font-size: 3vw;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00, 0 0 20px #ff0000;
      white-space: pre-wrap;
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    /* ====== BALL ====== */
    #ball {
      position: absolute;
      width: 50px;
      height: 50px;
    }

    /* ====== FOOTER ====== */
    .footer {
      position: absolute;
      bottom: 10px;
      color: #00ff00;
      font-size: 2vw;
      text-shadow: 0 0 10px #00ff00;
    }

    /* ====== TEMPORARY MESSAGES (Point, Deuce, Advantage, etc.) ====== */
    .message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4vw;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 20px red, 0 0 40px blue;
      display: none;
    }
  </style>
</head>
<body>

  <!-- TITLE -->
  <div class="glow-text">Sherk Pong</div>

  <!-- MATCH SCORE (BEST OF 3) -->
  <div class="match-label" id="sherkMatches">Matches: 0</div>
  <div class="match-label" id="bonkMatches">Matches: 0</div>

  <!-- PLAYER NAMES & GAME SCORE -->
  <div class="player-label player-left">Player: Sherk</div>
  <div class="score-label" id="sherkScore">0</div>

  <div class="player-label player-right">Player: Pepe</div>
  <div class="score-label" id="bonkScore">0</div>

  <!-- INSTRUCTIONS & START BUTTON -->
  <div id="instructions-container" class="instructions-container">
    <div class="instructions">
      Touch or move your mouse to control Sherk.<br>
      Each game uses tennis-like points (1,2,3,4, Deuce, Advantage).<br>
      You need a 2-point lead to win a game.<br>
      First to 3 games is the Champion.<br><br>
    </div>
    <button class="button" onclick="startGame()">Play</button>
  </div>

  <!-- CANVAS & IMAGES -->
  <canvas id="pongCanvas"></canvas>
  <img src="Sherk.png" id="sherk" class="player">
  <img src="Bonk.png" id="bonk" class="player">
  <img src="ball.png" id="ball">

  <!-- WINNER MESSAGE (END OF GAME OR END OF TOURNAMENT) -->
  <div id="winner-message">
    <p id="winner-text"></p>
    <button id="winner-button" class="button" onclick="startNextAction()">...</button>
  </div>

  <!-- TEMPORARY MESSAGE (Point, Deuce, Advantage, etc.) -->
  <div id="game-message" class="message"></div>

  <!-- FOOTER -->
  <div class="footer">Sherk Games - Sherkfun.io</div>

  <!-- SOUNDS -->
  <audio id="hitSound" src="hit_sound.MP3" preload="auto"></audio>
  <audio id="bgMusic" src="bg_music.MP3" loop="true" preload="auto"></audio>
  <audio id="pointSound" src="point.MP3" preload="auto"></audio>
  <audio id="pointSound" src="point.mp3" preload="auto"></audio>
  <audio id="matchPointSound" src="match_point.mp3" preload="auto"></audio>
  <audio id="deuceSound" src="deuce.mp3" preload="auto"></audio>
  <audio id="gameSetMatchSound" src="game_set_match.mp3" preload="auto"></audio>

  <script>
    /* ==================== GAME SETUP ==================== */
    const canvas = document.getElementById("pongCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // References
    const ball         = document.getElementById("ball");
    const ballWidth    = 50; // Fixed dimension to avoid undefined
    const ballHeight   = 50; // same reason
    const sherkScoreEl = document.getElementById("sherkScore");
    const bonkScoreEl  = document.getElementById("bonkScore");
    const sherkMatchEl = document.getElementById("sherkMatches");
    const bonkMatchEl  = document.getElementById("bonkMatches");
    const winnerMsgEl  = document.getElementById("winner-message");
    const winnerTextEl = document.getElementById("winner-text");
    const winnerButton = document.getElementById("winner-button");
    const gameMessage  = document.getElementById("game-message");

    // Sounds
    const hitSound         = document.getElementById("hitSound");
    const bgMusic          = document.getElementById("bgMusic");
    const pointSound       = document.getElementById("pointSound");
    const deuceSound       = document.getElementById("deuceSound");
    const matchPointSound  = document.getElementById("matchPointSound");
    const gameSetMatchSound= document.getElementById("gameSetMatchSound");

    // Music volume
    bgMusic.volume = 0.3;

    /* ==================== GAME VARIABLES ==================== */
    const initialSpeedX = 2, initialSpeedY = 1.5;
    const playerHeight  = 200;
    let ballX = canvas.width / 2, ballY = canvas.height / 2;
    let ballSpeedX = initialSpeedX, ballSpeedY = initialSpeedY;
    let ballAngle = 0;
    let sherkY = canvas.height / 2 - playerHeight / 2;
    let bonkY  = canvas.height / 2 - playerHeight / 2;

    // Tennis-like points
    let sherkPoints  = 0;
    let bonkPoints   = 0;
    let sherkMatches = 0;
    let bonkMatches  = 0;
    let gameRunning  = false;

    /* ==================== MESSAGING ==================== */
    function showMessage(txt) {
      if(!txt) return;
      gameMessage.innerText = txt;
      gameMessage.style.display = "block";
      setTimeout(() => {
        gameMessage.style.display = "none";
      }, 1500);
    }

    /* ==================== EVENT LISTENERS ==================== */
    document.addEventListener("mousemove", e => {
      if(gameRunning) {
        sherkY = Math.max(0, Math.min(canvas.height - playerHeight, e.clientY - playerHeight/2));
      }
    });
    let touchStartY = 0;
    document.addEventListener("touchstart", e => {
      touchStartY = e.touches[0].clientY;
    });
    document.addEventListener("touchmove", e => {
      if(gameRunning) {
        const touchEndY = e.touches[0].clientY;
        const deltaY = touchEndY - touchStartY;
        sherkY = Math.max(0, Math.min(canvas.height - playerHeight, sherkY + deltaY));
        touchStartY = touchEndY;
      }
    });

    /* ==================== START GAME ==================== */
    function startGame() {
      document.getElementById("instructions-container").style.display = "none";
      gameRunning = true;
      bgMusic.currentTime = 0;
      bgMusic.play();
      gameLoop();
    }

    /* ==================== TENNIS SCORING ==================== */
    function updateTennisScore(winner) {
      if(winner === "Sherk") {
        sherkPoints++;
      } else {
        bonkPoints++;
      }

      const diff = sherkPoints - bonkPoints;
      if(sherkPoints >=4 || bonkPoints >=4) {
        if(diff === 0 && sherkPoints >=4) {
          // Deuce
          showMessage("Deuce!");
          deuceSound.play();
        }
        else if(diff === 1 && sherkPoints >=4) {
          showMessage("Advantage Sherk!");
          matchPointSound.play();
        }
        else if(diff === -1 && bonkPoints >=4) {
          showMessage("Advantage Pepe!");
          matchPointSound.play();
        }
        else if(diff >= 2 && sherkPoints >=4) {
          // Sherk wins game
          gameWonBy("Sherk");
        }
        else if(diff <= -2 && bonkPoints >=4) {
          // Pepe wins game
          gameWonBy("Pepe");
        }
        else {
          // Normal point
          showMessage(`Point for ${winner}!`);
          pointSound.play();
        }
      } else {
        // Under 4 points, standard
        showMessage(`Point for ${winner}!`);
        pointSound.play();
      }
    }

    function gameWonBy(player) {
      if(player === "Sherk") {
        sherkMatches++;
      } else {
        bonkMatches++;
      }
      showMessage(`${player} wins the Game!`);

      // reset points, continue playing
      sherkPoints = 0;
      bonkPoints  = 0;
      drawScore();

      // Check if match is over
      if(sherkMatches === 3 || bonkMatches === 3) {
        endMatch();
      }
    }

    function endMatch() {
      // End entire best-of-3
      gameRunning = false;
      bgMusic.pause();
      gameSetMatchSound.currentTime = 0;
      gameSetMatchSound.play();

      winnerMsgEl.style.display = "block";
      winnerTextEl.innerText    = "Match Over!";
      winnerButton.innerText    = "Start New Match";
    }

    /* ==================== DRAW SCORES ==================== */
    function drawScore() {
      sherkScoreEl.innerText = tennisDisplay(sherkPoints, bonkPoints);
      bonkScoreEl.innerText  = tennisDisplay(bonkPoints, sherkPoints);

      if(sherkPoints > bonkPoints) {
        sherkScoreEl.style.color = "blue";
        bonkScoreEl.style.color  = "red";
      } else if(bonkPoints > sherkPoints) {
        sherkScoreEl.style.color = "red";
        bonkScoreEl.style.color  = "blue";
      } else {
        sherkScoreEl.style.color = "#00ff00";
        bonkScoreEl.style.color  = "#00ff00";
      }

      sherkMatchEl.innerText = `Matches: ${sherkMatches}`;
      bonkMatchEl.innerText  = `Matches: ${bonkMatches}`;
    }

    function tennisDisplay(playerPts, oppPts) {
      let diff = playerPts - oppPts;
      if(playerPts >=4 || oppPts >=4) {
        if(diff === 0 && playerPts >=4) return "Deuce";
        if(diff === 1 && playerPts >=4) return "Adv";
        if(diff >= 2) return "Game";
      }
      return String(playerPts);
    }

    /* ==================== BALL LOOP ==================== */
    function updateBall() {
      ballX += ballSpeedX;
      ballY += ballSpeedY;
      ballAngle += 5;
      ball.style.transform = `rotate(${ballAngle}deg)`;

      // Top/bottom collisions
      if(ballY <= 0 || (ballY + ballHeight >= canvas.height)) {
        ballSpeedY = -ballSpeedY;
      }
      // Collision with Sherk
      if(
        ballX <= 100 &&
        ballY + ballHeight > sherkY &&
        ballY < sherkY + playerHeight
      ) {
        ballSpeedX = -ballSpeedX;
        increaseBallSpeed();
        hitSound.play();
      }
      // Collision with Pepe
      if(
        ballX + ballWidth >= canvas.width - 100 &&
        ballY + ballHeight > bonkY &&
        ballY < bonkY + playerHeight
      ) {
        ballSpeedX = -ballSpeedX;
        increaseBallSpeed();
        hitSound.play();
      }

      // Out left => Pepe point
      if(ballX + ballWidth < 0) {
        updateTennisScore("Pepe");
        drawScore();
        resetBall();
      }
      // Out right => Sherk point
      if(ballX > canvas.width) {
        updateTennisScore("Sherk");
        drawScore();
        resetBall();
      }

      moveBonk();
      movePlayers();
    }

    function resetBall() {
      ballX = canvas.width / 2 - ballWidth/2;
      ballY = canvas.height / 2 - ballHeight/2;
      ballSpeedX = (Math.random() > 0.5 ? 1 : -1) * initialSpeedX;
      ballSpeedY = (Math.random() > 0.5 ? 1 : -1) * initialSpeedY;
      ballAngle = 0;
    }

    function moveBonk() {
      const targetY = ballY + ballHeight/2 - playerHeight/2;
      bonkY += (targetY - bonkY) * 0.05;
      bonkY = Math.max(0, Math.min(canvas.height - playerHeight, bonkY));
    }

    function movePlayers() {
      document.getElementById("sherk").style.top = `${sherkY}px`;
      document.getElementById("bonk").style.top  = `${bonkY}px`;
      ball.style.left = `${ballX}px`;
      ball.style.top  = `${ballY}px`;
    }

    function gameLoop() {
      updateBall();
      if(gameRunning) requestAnimationFrame(gameLoop);
    }

    /* ==================== MATCH RESTART ==================== */
    function startNextAction() {
      // If we had a champion:
      if(sherkMatches === 3 || bonkMatches === 3) {
        sherkMatches = 0;
        bonkMatches  = 0;
        sherkPoints  = 0;
        bonkPoints   = 0;
      }
      winnerMsgEl.style.display = "none";
      drawScore();
      resetBall();

      bgMusic.currentTime = 0;
      bgMusic.play();
      gameRunning = true;
      gameLoop();
    }
  </script>
</body>
</html>
