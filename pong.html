<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tênis Simplificado - Best of 3</title>

  <style>
    /* Estilos básicos */
    body {
      margin: 0;
      padding: 0;
      background: url('back.gif') center no-repeat;
      background-size: cover;
      overflow: hidden;
      font-family: monospace;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    body::after {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: black;
      opacity: 0.5;
      z-index: -1;
    }
    .glow-text {
      font-size: 4vw;
      color: #00ff00;
      text-shadow: 0 0 20px #00ff00, 0 0 40px #0077ff;
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
    }
    /* Matches = quantas “partidas” (games) cada um ganhou */
    .match-label {
      position: absolute;
      font-size: 3vw;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00;
    }
    #leftMatches { top: 10px; left: 20px; }
    #rightMatches { top: 10px; right: 20px; }

    /* Pontos do Game (0 a 4, advantage, etc.) */
    .score-label {
      position: absolute;
      font-size: 5vw;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00;
      font-weight: bold;
    }
    #leftScore {
      top: 60px; left: 60px;
    }
    #rightScore {
      top: 60px; right: 60px;
    }

    .instructions-container {
      position: absolute;
      top: 40%; left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
    }
    .instructions {
      font-size: 2vw;
      margin-bottom: 20px;
    }
    .button {
      padding: 15px 30px;
      font-size: 2vw;
      color: #fff;
      background: linear-gradient(90deg, #00f0ff, #ff0000);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 0 20px #00f0ff;
    }
    .button:hover {
      box-shadow: 0 0 40px #ff0000;
    }
    #winner-message {
      font-size: 3vw;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00, 0 0 20px #ff0000;
      display: none;
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }
    .message {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4vw;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 20px red, 0 0 40px blue;
      display: none;
    }
  </style>
</head>
<body>

<div class="glow-text">Tênis Simplificado</div>

<!-- Partidas (Matches) -->
<div class="match-label" id="leftMatches">Matches: 0</div>
<div class="match-label" id="rightMatches">Matches: 0</div>

<!-- Pontuação do Game -->
<div class="score-label" id="leftScore">0</div>
<div class="score-label" id="rightScore">0</div>

<div id="instructions-container" class="instructions-container">
  <div class="instructions">
    Jogo de Tênis Simplificado!<br>
    - Pontos do game: 0,1,2,3 => 4 = fecha se tiver 2 de diferença<br>
    - Se ambos chegarem a 3, fica Deuce / Advantage<br>
    - Quem ganhar 3 matches vence a partida inteira!
  </div>
  <button class="button" onclick="startGame()">Play</button>
</div>

<div id="winner-message">
  <p id="winner-text"></p>
  <button class="button" onclick="startNewGame()">Novo Torneio</button>
</div>

<div id="game-message" class="message"></div>

<script>
  /* =========================== VARIÁVEIS =========================== */
  let leftGameScore = 0;
  let rightGameScore = 0;
  let leftMatches = 0;
  let rightMatches = 0;
  let advantage = null; // 'left' ou 'right' ou null
  let gameRunning = false;
  const neededMatches = 3; // Quem chegar a 3, vence

  /* =========================== FUNÇÕES DE INTERFACE =========================== */
  function startGame() {
    document.getElementById('instructions-container').style.display = 'none';
    gameRunning = true;
    updateDisplays();
  }

  function updateDisplays() {
    let leftScoreText  = convertTennisScore('left');
    let rightScoreText = convertTennisScore('right');

    document.getElementById('leftScore').innerText  = leftScoreText;
    document.getElementById('rightScore').innerText = rightScoreText;
    document.getElementById('leftMatches').innerText  = `Matches: ${leftMatches}`;
    document.getElementById('rightMatches').innerText = `Matches: ${rightMatches}`;
  }

  // Converte a pontuação interna (0,1,2,3 => advantage) para exibir
  function convertTennisScore(side) {
    // Se estiver em advantage, exibir "AD"
    if (advantage === side) {
      return 'AD';
    }
    // Se o outro lado está em advantage e este não, exibir a pontuação normal
    if (advantage !== null && advantage !== side) {
      // Exibir a pontuação normal do side
      let s = (side === 'left' ? leftGameScore : rightGameScore);
      return s.toString();
    }

    // Caso normal (0..3)
    let s = (side === 'left' ? leftGameScore : rightGameScore);
    return s.toString();
  }

  // Exibe mensagem por 1.5s
  function showTempMessage(msg) {
    const el = document.getElementById('game-message');
    el.innerText = msg;
    el.style.display = 'block';
    setTimeout(() => { el.style.display = 'none'; }, 1500);
  }

  /* =========================== LÓGICA DE PONTOS =========================== */
  // Chamamos esta função quando 'left' ou 'right' ganha um ponto
  function addPoint(side) {
    if (!gameRunning) return;

    // Se estamos em advantage
    if (advantage === side) {
      // Se side já estava em advantage, ele fecha o game
      showTempMessage(`Game for ${side === 'left' ? 'LEFT' : 'RIGHT'}!`);
      finishGame(side);
      return;
    }
    if (advantage !== null && advantage !== side) {
      // Se o outro estava em advantage, agora volta para deuce
      advantage = null;
      showTempMessage('Back to Deuce!');
      updateDisplays();
      return;
    }

    // Caso normal (sem advantage) => incrementa a pontuação do side
    if (side === 'left') leftGameScore++;
    else rightGameScore++;

    // Se ambos chegarem a 3 => Deuce
    if (leftGameScore === 3 && rightGameScore === 3) {
      showTempMessage('Deuce!');
    }
    // Verificar se alguém chegou a 4 e tem 2 de diferença
    if (leftGameScore >= 4 || rightGameScore >= 4) {
      let diff = Math.abs(leftGameScore - rightGameScore);
      if (diff >= 2) {
        // Fecha o game
        showTempMessage(`Game for ${side === 'left' ? 'LEFT' : 'RIGHT'}!`);
        finishGame(side);
        return;
      } else if (diff === 1) {
        // Advantage
        advantage = side;
        showTempMessage(`Advantage ${side === 'left' ? 'LEFT' : 'RIGHT'}!`);
      }
    }

    updateDisplays();
  }

  // Fecha o game e soma 1 match a quem ganhou
  function finishGame(side) {
    if (side === 'left') {
      leftMatches++;
    } else {
      rightMatches++;
    }
    // Reseta pontuações
    leftGameScore = 0;
    rightGameScore = 0;
    advantage = null;

    updateDisplays();
    // Verifica se alguém chegou a neededMatches
    if (leftMatches === neededMatches || rightMatches === neededMatches) {
      // Alguém é campeão
      showWinner(side);
    }
  }

  // Exibe a janela final do campeão
  function showWinner(side) {
    gameRunning = false;
    document.getElementById('winner-text').innerText = 
      `${side === 'left' ? 'LEFT' : 'RIGHT'} is the Champion!`;
    document.getElementById('winner-message').style.display = 'block';
  }

  // Botão final
  function startNewGame() {
    document.getElementById('winner-message').style.display = 'none';
    leftMatches = 0;
    rightMatches = 0;
    leftGameScore = 0;
    rightGameScore = 0;
    advantage = null;
    updateDisplays();
    gameRunning = true;
  }

  /* =========================== EXEMPLO DE BOTÕES PARA MARCAR PONTOS =========================== */
  // Abaixo, em um jogo real, você teria a lógica do “ball collision” etc. 
  // Mas aqui, exemplificamos com 2 funções para “forçar” um ponto. Você pode integrá-las ao seu canvas.
  document.addEventListener('keydown', (e) => {
    // Por exemplo: A = ponto left, L = ponto right
    if (e.key === 'a' || e.key === 'A') {
      addPoint('left');
    }
    if (e.key === 'l' || e.key === 'L') {
      addPoint('right');
    }
  });
</script>
</body>
</html>
