<script>
    const canvas = document.getElementById("pongCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const ball = document.getElementById("ball");
    let ballX = canvas.width / 2;
    let ballY = canvas.height / 2;
    let ballSpeedX = 2;
    let ballSpeedY = 1.5;
    let ballAngle = 0;

    const playerHeight = 150;
    let sherkY = canvas.height / 2 - playerHeight / 2;
    let bonkY = canvas.height / 2 - playerHeight / 2;

    let leftScore = 0;
    let rightScore = 0;
    let gameRunning = false;
    let missCounter = 0;
    let bonkMissNext = false;

    document.addEventListener("mousemove", (e) => {
        if (gameRunning) {
            sherkY = e.clientY - playerHeight / 2;
        }
    });

    function drawScore() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.font = "5vw Arial";
        ctx.fillStyle = leftScore > rightScore ? "#0077ff" : "#ff0000";
        ctx.fillText(leftScore, canvas.width / 3, 50);

        ctx.fillStyle = rightScore > leftScore ? "#0077ff" : "#ff0000";
        ctx.fillText(rightScore, (canvas.width / 3) * 2, 50);
    }

    function updateBall() {
        ballX += ballSpeedX;
        ballY += ballSpeedY;
        ballAngle += 5;
        ball.style.transform = `rotate(${ballAngle}deg)`;

        if (ballY <= 0 || ballY + ball.height >= canvas.height) {
            ballSpeedY = -ballSpeedY;
        }

        if (ballX <= 100 && ballY > sherkY && ballY < sherkY + playerHeight) {
            ballSpeedX = -ballSpeedX;
        }

        if (ballX >= canvas.width - 100 - ball.width) {
            if (bonkMissNext) {
                leftScore++;
                bonkMissNext = false;
                resetBall();
            } else if (ballY > bonkY && ballY < bonkY + playerHeight) {
                ballSpeedX = -ballSpeedX;
                bonkMissNext = Math.random() < 0.3; // 30% chance de errar
            }
        }

        if (ballX < 0) {
            rightScore++;
            resetBall();
        }

        if (leftScore === 5) {
            showWinner();
        }
    }

    function resetBall() {
        ballX = canvas.width / 2;
        ballY = canvas.height / 2;
        ballSpeedX = -ballSpeedX;
    }

    function showWinner() {
        gameRunning = false;
        document.getElementById("winner-message").style.display = "block";
    }

    function restartGame() {
        leftScore = 0;
        rightScore = 0;
        document.getElementById("winner-message").style.display = "none";
        document.getElementById("instructions-container").style.display = "block";
    }

    function moveBonk() {
        if (bonkMissNext) {
            bonkY += (Math.random() > 0.5 ? 50 : -50);
        } else {
            const targetY = ballY - playerHeight / 2 + ball.height / 2;
            bonkY += (targetY - bonkY) * 0.1; // Suaviza o movimento do Bonk
        }
        bonkY = Math.max(0, Math.min(bonkY, canvas.height - playerHeight));
    }

    function movePlayers() {
        document.getElementById("sherk").style.top = `${sherkY}px`;
        document.getElementById("bonk").style.top = `${bonkY}px`;
        ball.style.left = `${ballX}px`;
        ball.style.top = `${ballY}px`;
    }

    function gameLoop() {
        drawScore();
        moveBonk();
        updateBall();
        movePlayers();
        if (gameRunning) requestAnimationFrame(gameLoop);
    }

    function startGame() {
        document.getElementById("instructions-container").style.display = "none";
        gameRunning = true;
        gameLoop();
    }
</script>
